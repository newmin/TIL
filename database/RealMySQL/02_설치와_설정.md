# Real MySQL - 2. 설치와 설정
#TIL/Database

---

## 서버 설정

### my.cnf 설정 파일의 위치

MySQL 서버는 단 하나의 설정 파일만 사용하는데, 유닉스 계열에서는 `my.cnf` 라는 이름을 사용한다.  
서버를 시작할 때만 해당 파일을 참조하는데, 지정된 여러 개의 디렉터리를 순회하면서 처음 발견된 my.cnf 파일을 사용한다.  

my.cnf 를 찾기 위해 순회하는 디렉터리 경로가 궁금하다면 다음의 명령어들로 확인해볼 수 있다.  
단, mysqld 프로그램은 MySQL 서버의 실행 프로그램으로 해당 option 을 빠뜨리면 실제 서버를 기동할 수 있으니 두번째 명령어로 확인해 보는 것이 좋다.  

```bash
mysqld --verbose --help
mysql --help
```

해당 명령어의 결과를 살펴보면 상당히 많은 내용 안에 다음과 같은 내용이 있다.  

```vim
Default options are read from the following files in the given order:
/etc/my.cnf /etc/mysql/my.cnf /usr/local/mysql/etc/my.cnf ~/.my.cnf
```


### MySQL 시스템 변수

MySQL 서버는 시작할 때 설정 파일의 내용을 읽어 여러가지 설정값들을 변수에 저장해놓는데, 이를 `시스템 변수` 라고 한다.  

시스템 변수는 `SHOW VARIABLES` 명령어나 `SHOW GLOBAL VARIABLES` 명령어로 확인할 수 있는데, 이 변수들이 실제로 서버와 클라이언트에 어떤 영향을 미치는지 알기 위해서는 각 변수가 글로벌 변수인지 세션 변수인지를 구분할 수 있어야 한다.  


### 글로벌 변수와 세션 변수

- 글로벌 변수 : 하나의 MySQL 서버 인스턴스에서 전체적으로 영향을 미치는 시스템 변수이다. 쿼리 캐시의 크기(query_cache_size), InnoDB 버퍼 풀의 크기(innodb_buffer_pool_size) 와 같이 MySQL 서버 자체에 관련된 설정이 대부분이다.  
- 세션 변수 : MySQL 클라이언트가 서버에 접속할 때 기본적으로 부여하는 옵션의 기본값을 제어하는 데 사용된다. 따라서 클라이언트의 필요에 따라 개별 커넥션 단위로 다른 값으로 변경할 수 있는 변수이다.  
- 세션 범위의 시스템 변수 가운데 my.cnf 에 명시해 초기화할 수 있는 변수는 대부분 범위가 "Both" 라고 명시돼 있다. 순수하게 세션 범위인 변수는 설정 파일에 초기 값을 명시할 수 없다.  


### 동적 변수와 정적 변수

MySQL 서버의 시스템 변수는 서버가 기동 중인 상태에서 변경 가능한지 여부에 따라 동적 변수와 정적 변수로 나뉜다.  
변경하고자 하는 값이 동적 변수라면 굳이 서버를 재시작할 필요 없이 SET 명령으로 값을 변경할 수 있다.  
하지만 my.cnf 파일까지는 업데이트 되지 않으니 추후에도 변경된 값을 사용하고 싶다면 설정 파일도 변경해주어야 한다.  

설정 범위가 "Both" 로 글로벌 변수이면서 세션 변수인 경우는 글로벌 변수의 값을 변경하더라도 이미 존재하는 커넥션의 세션 변수 값은 변경되지 않고 유지된다.  

### my.cnf 설정 파일

my.cnf 설정 파일에서 가장 중요한 설정 그룹은 [mysqld] 설정 그룹이다.  
주요 내용을 살펴보자.  

```vim
server-id = 1

user = mysql
port = 3306
basedir = /usr/local/mysql
datadir = /usr/local/mysql/data
```

- server-id : MySQL 이 내부적으로 자기 자신을 식별하는 아이디 값이다.
- user : MySQL 이 설치된 서버의 운영체제 계정을 입력한다. MySQL 서버는 입력된 운영체제 계정으로 MySQL 인스턴스를 실행한다.

- basedir : MySQL 서버의 홈 디렉토리를 명시한다.
- datadir : MyISAM 의 데이터 파일이 저장되는 디렉토리다.
- tmpdir : MySQL 서버는 정렬이나 그룹핑과 같은 처리를 위해 내부적으로 임시 테이블을 생성한다. tmpdir 은 내부 임시 테이블의 데이터 파일이 저장되는 위치이며, 쿼리가 종료되면 데이터는 자동으로 삭제된다. 사용자가 생성하는 "CREATE TEMPORARY TABLE" 의 임시 테이블과는 다르다.

- character-set-server, collation-server : MySQL 서버의 기본 문자집합을 설정한다.  

- default-storage-engine : MySQL 서버 내에서 기본적으로 사용할 스토리지 엔진을 정의한다.
	- MySQL 서버가 내부적으로 생성하는 임시 테이블은 MyISAM 스토리지 엔진만 사용한다.

- skip-name-resolve : 클라이언트의 접속 시 해당 클라이언트가 접속 허용된 사용자인지 확인하기 위해, 클라이언트의 IP 주소를 이용해 역으로 DNS 명을 가져오는 역 DNS 검색을 하지 않는 옵션이다.
	- 이 옵션은 설정 변수명 자체가 name-resolve 작업을 비활성화한다는 뜻이다.
	- 성능상의 이유로 역 DNS 검색은 비활성화해서 사용하는 것이 일반적이다.

- event-scheduler : 일정 시간에 반복되는 작업을 목적으로 이벤트 스케줄러라는 기능을 사용할 수 있다.
	- 이벤트 스케줄러는 MySQL 내에서 실행되는 별도의 스레드를 필요로 한다.

- max-connections : MySQL 서버가 최대한 허용할 수 있는 클라이언트의 연결 수를 제한하는 설정이다.

