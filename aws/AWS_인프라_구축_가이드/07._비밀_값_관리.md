# 7. 비밀 값 관리
## 비밀 값

대부분의 애플리케이션은 데이터베이스 접속 정보나, 서드파티 서비스를 이용하기 위한 액세스 키 등의 비밀 값들을 갖고 있다.  

비밀 값을 관리하기 위한 원칙에는 다음과 같은 것들이 있다.

- 비밀 값은 버전 관리 시스템에 업로드되면 안 된다.
- 비밀 값은 최소한의 인원만 알고 있어야 한다. 
- 비밀 값과 아닌 값은 분리해서 관리해야 한다.

## 관리 방법

### 배포 자동화 툴

젠킨스(Jenkins), 셰프(Chef), 앤서블(Ansible)과 같은 데브옵스 서비스들도 배포 자동화 기능을 지원한다.  

인스턴스를 배포할 때 애플리케이션이 시작되기 이전에 운영체제의 환경변수나 파일에 비밀 값들을 저장하고 사용하도록 해당 툴들에 지정할 수 있다.  

### Blackbox

비밀 값들을 담고 있는 파일을 암호화해서 VCS에 올리는 방법도 있는데, 많이 사용되는 오픈소스로 Blackbox가 있다.  

스택오버플로우 사이트를 만든 Stack  Exchange에서 만든 툴로, 암호화, 복호화, 관리자 관리 기능 등을 지원한다.  

### AWS Secrets Manager

AWS에서 제공하는 비밀 값 관리 서비스다.  

비밀 값들을 저장해두고 애플리케이션에서 AWS API를 호출해서 받아가는 방식이다.  

1. 관리자가 Secrets Manager에 비밀을 만들고 그 비밀 안에 key-value 형태로 값을 등록한다.
2. 비밀 값들은 AWS KMS(Key Management Service)라는 키 관리 서비스를 통해 암호화된다.
3. 비밀 값을 사용하는 서버에서 AWS CLI나 SDK를 이용해 특정 IAM 사용자로 Secrets Manager에 비밀 값들을 요청한다.
4. IAM에서 요청한 사용자의 권한이 확인되면 Secrets Manager가 비밀 값을 복호화하여 응답으로 준다.

Secrets Manager는 비밀이라는 단위 안에 여러 개의 키/값 쌍을 저장할 수 있기 때문에 애플리케이션이나 환경 별로 비밀 값들을 관리하기 쉽다. 또한 각 값에 대한 변경 이력도 볼 수 있으며, 누군가 삭제하더라도 일정 기간 동안에는 보존되고 있어 보다 안전하게 관리할 수 있다.  

### AWS Systems Manager의 파라미터 스토어

AWS Systems Manager라는 서비스에 파라미터 스토어라는 기능도 유사한 기능을 제공하는데, Secrets Manager와는 다음과 같은 차이가 있다.  

- 파라미터 스토어는 무료다.
- Secrets Manager는 비밀이라는 단위로 키/값 쌍을 묶어서 저장할 수 있다.
- Secrets Manager는 RDS와 직접적인 연동이 된다.
- Secrets Manager는 키를 삭제하고 일정 기간 동안 복원할 수 있다.

파라미터 스토어가 무료이긴 하지만, AWS에서 Secrets Manager를 비밀 값 관리 서비스로 내세운 만큼 더 많은 확장 가능성이 있어 보인다.  
