# 06. 인증과 권한 부여 - AWS Identity and Access Management
#TIL/aws/SAA

---

## 소개

높은 보안 수준을 유지하면서, 관리자와 고객의 액세스는 허용할 수 있는 완벽한 방법이 바로 IAM이다.  
IAM은 사용자의 요청을 인증(Authentification)해서 정당하게 사용하는 것을 확인하고 권한 부여(Authorization)로 필요한 만큼 정확하게 액세스할 수 있게 한다.  


## IAM 자격 증명

새 AWS 계정을 만들면 하나의 자격 증명이 같이 만들어지며, 이 자격 증명은 루트 사용자이다.  
AWS는 보안 취약점 노출을 줄이기 위해 루트 계정을 철저하게 보호하고 일상적 작업에 필요한 구체적 권한을 다른 사용자에게 위임하는 것을 제안한다.  

### IAM 정책

정책을 사용해서 IAM 자격 증명을 제어하는 방법을 이해해야 한다.  

IAM 정책은 AWS 리소스에 연결된 작업(Action)을 정의하는 문서이다.  
정책 문서에서 효과(Effect)를 지정해서 리소스 작업을 허용할지 여부를 결정한다.  
이때, 효과의 값으로 허용(Allow) 또는 거부(Deny)를 사용한다.  

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*"
    }
  ]
}
```

정책에서 명시적으로 허용하지 않는 작업은 모두 거부된다.  

단일 IAM 정책은 여러 개 자격 증명과 연결될 수 있으며 단일 자격 증명은 10개 관리형 정책과 연결할 수 있다.  

정책 간 충돌이 생길 경우, AWS는 거부를 허용보다 우선시해서 적용한다.  


### 사용자와 루트 계정

루트 계정을 보호하는 방법은 다음과 같이 계정을 잠그는 것이다.  

- 루트와 연결된 모든 액세스 키를 삭제한다.
- 길고 복잡하게 비밀번호를 만들고 안전한 비밀번호 보관소에 저장한다.
- 루트 계정에 멀티 팩터 인증(MFA)을 사용한다.
- 가능하면 아무데서나 루트를 사용하지 않는다.


### 액세스 키

액세스 키는 프로그래밍 방식 또는 CLI를 통해 액세스할 때 인증에 사용된다.  
사용자 이름과 비밀번호를 입력하는 방식 이외에, 액세스 키 ID와 보안 액세스 키로 로컬 환경에서 액세스할 수 있게 한다.  
애플리케이션이나 명령에서 보내는 데이터에 액세스 키 정보가 포함돼 인증 및 요청이 함께 처리된다.  


### 그룹

사용자의 효율적인 역할 관리를 위해 사용자의 직무 유형별로 IAM 그룹을 만들고, 각 사용자를 그들의 직무에 맞는 그룹에 연결할 수 있다.  

IAM 그룹을 이용하면, 특정 직무 유형의 액세스 프로필을 변경해야 할 때 해당하는 모든 사용자 계정을 건드리지 않고 해당 그룹만 업데이트하면 된다.  


### 역할

IAM 역할은 임시 자격 증명으로, 계정의 리소스에 액세스하려는 사용자나 서비스의 요청에 사용된다.  
또한 IAM 역할을 사용하면, 다른 AWS 계정의 사용자나 연동 인증 서비스를 사용해 로그인한 사용자에게 계정 리소스에 액세스할 수 있게 임시로 권한을 부여할 수 있다.  

새로운 역할은 액세스 권한을 부여할 신뢰할 수 있는 엔티티를 정해서 생성한다.  
신뢰할 수 엔티티는 다음과 같다.  

- AWS 서비스
- 다른 AWS 계정(계정 ID)
- Amazon/Amazon Cognito/Facebook/Google 로그인을 사용해서 인증하는 웹 자격 증명
- 별도록 정의한 SAML 공급자를 통해나 SAML 2.0 연동

엔티티가 정의되면 자체 정책 문서를 작성해서 연결하거나, 미리 설정된 IAM 정책을 할당해서 사용 권한을 부여한다.  
신뢰할 수 있는 엔티티에 새 역할을 부여하면 AWS는 AWS STS(Security Token Service)를 사용해서 기간 한정 보안 토큰을 발급한다.  


## 인증 도구

### Amazon Cognito

Cognito는 두 가지 중요한 인증 기능을 제공한다.  

- Cognito의 사용자 풀로 애플리케이션에 사용자 등록과 로그인을 추가할 수 있다.
- Cognito의 자격 증명 풀로 애플리케이션 사용자에게 AWS 계정 내 다른 서비스 액세스를 임시로 제어할 수 있다.

Cognito는 가입하거나 로그인할 때 사용자가 자격 증명하는 방법을 정의해서 새로운 사용자 풀을 구축하게 한다.  
비밀번호 복잡도, MFA, 전자 메일 확인을 위한 최소 요구 사항을 설정할 수 있다.  

자격 증명 풀을 설정할 때 사용자가 어떤 서비스를 사용할지 정의할 수 있다.  


### AWS Managed Microsoft AD

Managed Microsoft AD는 Amazon Cloud Directory나 Cognito 같은 디렉토리 관리 도구처럼 AWS Directory Service로 AWS에 액세스할 수 있게 한다.  

> Cloud Directory는 조직의 사용자나 하드웨어 자산 목록과 같은 계층적 데이터를 저장하고 활용하는 수단이다.  

Directory Service 도구는 대용량 데이터를 처리하고 AWS 운영에 통합하는 기능을 제공한다.  

Managed Microsoft AD는 기본적으로는 Active Directory가 VPC에서 실행되는 Microsoft ShartPoint, NET, SQL Server 기반 워크로드를 AWS 리소스에 연결하는 방식을 제어한다.  
또한 AD 커넥터를 사용하면 온프레미스 Microsoft Active Directory에서 AWS 서비스에 연결할 수 있다.  


### AWS Single Sign-On

SSO를 사용하면 AWS Directory Service에 구성된 기존 Microsoft Active Directory로 간편하게 사용자 인증과 권한 부여를 수행할 수 있고, AWS Organizations 내 여러 AWS 계정에도 액세스할 수 있다.  
AWS Organizations는 여러 개 AWS 계정을 정책 기반 제어로 관리할 수 있는 서비스로서, AWS 계정이 2개 이상인 기업에서 클라우드에 배포된 자산을 파악하고 과금을 통합하는데 사용된다.  


### AWS Key Management Service

KMS는 AWS의 여타 서비스와 통합돼서 암호화 키 관리를 수행한다.  

KMS는 시스템 전반에서 중앙 집중적으로 암호화를 완벽하게 제어하고 관리하는 수단을 제공하며, 데이터 보호에 사용할 키를 생성, 추적, 교체, 삭제할 수 있다.  
AWS CloudTrail과 통합해서 규제 준수에 관련된 주요 이벤트를 모두 기록할 수 있다.  


### AWS Secrets Manager

IAM 역할은 AWS 서비스에 액세스할 수 있는 인증을 관리하는 데 사용될 수 있지만, 타사의 서비스나 데이터베이스에 대한 안전한 인증에는 소용이 없다.  

AWS 서비스가 아닌, 자체 애플리케이션이 사용할 리소스의 비밀번호나 타사 API 키를 관리해야 하는 경우, AWS Secrets Manager를 사용한다.  
Secrets Manager를 사용해서 요청 시마다 애플리케이션에 최신의 자격 증명을 전달하고, 자격 증명 교체도 자동으로 처리하는 것이 훨씬 효율적이다.  


### AWS CloudHSM

CloudHSM은 자체 웹 서버 인프라를 대체해서 클라우드에서 암호화 작업을 수행하는 가상 컴퓨팅 장치 클러스터다.  
웹 서버에서 수행했던 암호화 키 생성, 저장, 관리를 대신 수행한다.  

















































