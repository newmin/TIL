# 05. 데이터베이스
#TIL/aws/SAA

---

## 관계형 데이터베이스

### 온라인 트랜잭션 처리와 온라인 분석 처리

관계형 데이터베이스는 구성에 따라 온라인 트랜잭션 처리(OLTP, OnLine Transaction Processing)와 온라인 분석 처리(OLAP, OnLine Analytical Processing)로 나눌 수 있다.  

- OLTP  
	- OLTP 데이터베이스는 초당 몇 회씩 순차적으로 데이터를 빈번하게 읽고 쓰는 애플리케이션에 적합
	- 빠른 쿼리에 최적화
	- 이런 쿼리는 정기적이고 예측 가능한 경향이 있다.
	- 메모리가 상당히 필요할 수 있는데, 이는 빠른 액세스를 위해 자주 사용하는 테이블 일부를 메모리에 저장하기 때문
- OLAP  
	- OLAP 데이터베이스는 복잡한 대형 데이터 세트 쿼리에 최적화
	- 상당한 스토리지와 컴퓨팅이 필요하므로, 데이터웨어하우징 애플라케이션을 구축해 여러 OLTP 데이터베이스를 단일 OLAP 데이터베이스로 모으는 것이 일반적이다.

## Amazon Relational Database Service

### RDS

RDS를 사용해 데이터베이스를 배포할 때, 격리된 데이터베이스 환경인 데이터베이스 인스턴스 구성에서부터 시작한다.  
데이터베이스 인스턴스는 지정한 VPC 에 존재하나, EC2 인스턴스와는 다르게 AWS가 전적으로 데이터베이스 인스턴스를 관리한다.  
SSH를 사용해 액세스할 수 없으며, EC 2 인스턴스 사이에서도 보이지 않는다.  


### 데이터베이스엔진  

- MySQL
	- MySQL은 OLTP 애플리케이션용으로 설계
	- MySQL은 MyISAM과 InnoDB 두 가지 스토리지 엔진에서 하나를 선택할 수 있지만, 유일하게 RDS 관리형 자동 백업과 호환할 수 있는 엔진은 InnoDB이다.  
- MariaDB
	- MariaDB는 MySQL과 바이너리 수준의 호환성을 가지면서 기능을 향상한 데이터베이스
	- RDS와의 호환성을 최대화하기 위해 InnoDB를 사용할 것을 권장한다.
- Oracle
	- Oracle은 가장 널리 배포된 DBMS
- PostgreSQL
	- PostgreSQL은 스스로 가장 Oracle과 호환되는 오픈 소스 데이터베이스라고 홍보
- Amazon Aurora
	- Aurora는 Amazon이 MySQL과 PostgreSQL과 바이너리 수준의 호환성을 가지면서 기능을 향상시킨 데이터베이스
	- 가상 스토리지 계층을 사용해서 하부 스토리지 쓰기 횟수를 줄이기 때문에 MySQL과 PostgreSQL보다 쓰기 성능이 우수하다.
	- MySQL 호환 에디션에서 InnoDB 스토리지 엔진만 지원
	- MySQL에서 사용할 수 있는 Aurora Backtrack 기능으로 데이터베이스를 지난 72시간 이내 특정 시점으로 단 몇 초 만에 복구할 수 있다.    
- Microsoft SQL


### 데이터베이스옵션그룹  

옵션 그룹은 옵션이라는 관리 및 보안 기능을 지정해서 하나 이상의 인스턴스에 적용할 수 있게 한다.  
옵션을 사용하려면 메모리가 더 필요하므로 인스턴스에 충분한 메모리가 있는지 확인하고 필요한 것만 활성화해야 한다.  

옵션 그룹에서 사용 가능한 옵션은 데이터베이스 엔진마다 다르다.  

- Microsoft SQL Server와 Oracle
	- TDE(Transactional Data Encryption)를 제공해 스토리지에 쓰기를 수행하기 전에 엔진이 데이터를 암호화하게 한다.  
- MySQL과 MariaDB
	- 데이터베이스 사용자 로그인과 쿼리 활동을 기록하게 하는 감사 플러그인을 제공한다.  


### 데이터베이스 인스턴스 클래스  

데이터베이스 인스턴스를 시작할 때 처리 성능, 메모리, 네트워크 대역폭, 디스크 처리량이 어느 정도 필요한지 결정해야 한다.  
RDS는 데이터베이스 인스턴스 클래스를 다음 세 가지 유형으로 나눈다.  

- 표준  
	- 표준 인스턴스 클래스는 데이터베이스 요구를 대부분 충족한다.
- 메모리 최적화  
	- 메모리 최적화 인스턴스 클래스는 높은 처리 성능이 요구되는 데이터베이스용
	- 메모리를 더 많이 확보하고 있으면 메모리에 더 많은 데이터를 저장할 수 있으므로 쿼리 시간이 빨라진다. 
- 순간 확장 가능  
	- 순간 확장 가능 인스턴스는 개발, 테스트, 다른 비프로덕션 데이터베이스를 위한 인스턴스

데이터베이스 인스턴스는 EBS 스토리지를 사용한다.  
EBS 스토리지와의 데이터 전송을 위한 전용 대역폭을 제공하기 위해 표준과 메모리 최적화 인스턴스 클래스 유형은 EBS 최적화를 지원한다.  


### 스토리지  

데이터베이스 인스턴스에 적합한 스토리지 선택은 충분한 디스크 공간 확보 이상으로 중요하다.  

AWS는 초당 입력/출력 작업(IOPS)을 사용해 스토리지 성능을 측정한다.  
다른 모든 조건이 같을 때, IOPS가 큰 데이터베이스는 데이터를 저장하고 검색하는 속도가 더 빠르다.  

데이터베이스 스토리지의 속도는 할당된 IOPS 수에 제한된다.  
단일 I/O 작업에서 전송할 수 있는 데이터의 양은 데이터베이스 엔진이 사용하는 페이지 크기에 달려 있으며, 요구되는 IOPS 수준을 파악하려면 먼저 필요한 디스크 처리량을 알아야 한다.  

MySQL과 MariaDB의 페이지 크기는 16KB 이므로, 디스크에 16KB 의 데이터 쓰기가 하나의 I/O 작업을 구성한다.  
반면, Oracle, PostgreSQL, Microsoft SQL Server  는 8KB 크기의 페이지를 사용한다.  
페이지 크기가 클수록 단일 I/O 작업에서 더 많은 데이터를 전송할 수 있다.  

IOPS 수와 페이지 크기는 반비례 관계이다.  
페이지 크기가 클수록 같은 처리량을 달성하는 데 필요한 IOPS는 적어진다.  

스토리지 유형에 따라서 IOPS 수가 달라지며, AWS RDS는 다음 세 가지 유형의 스토리지를 제공한다.  

- 범용 SSD  
	- 데이터베이스 대부분은 범용 SSD 스토리지로 충분
	- RDS는 기본적으로 기가바이트당 3 IOPS 성능을 볼륨에 할당하며, 최대 10,000 IOPS까지 볼륨에 할당할 수 있다.  
	- 볼륨이 커지면 성능은 더 향상된다.
- 프로비저닝된 IOPS SSD(io1)
	- 프로비저닝된 IOPS SSD를 시용하면 인스턴스를 만들 때 필요한 IOPS 수를 간단하게 할당할수 있다.  
	- io1 스토리지에서는 순간 확장의 개념이 없다. 
	- 프로비저닝된 IOPS 수는 사용 여부와 관계없이 일정한 성능이 제공되고 그에 따른 비용이 청구되므로, 일관된 짧은 지연 시간에 성능이 필요한 OLTP 데이터베이스에 유용하다.  
	- 표준 또는 메모리 최적화 인스턴스 클래스를 사용할 때, RDS는 프로비저닝된 IOPS의 성능 변동 범위가 10% 이내로 유지되는 기간을 1년의 99.9%로 보장한다.
	- IOPS와 기가바이트 비율은 최소 50: 1(IOPS:GB) 이어야 한다.
- 마그네틱스토리지  
	- RDS는 구형 인스턴스의 호환성을 위해 마그네틱 스토리지를 제공한다.
	- 최대 크기는 4TB, 최대 성능은 1,000 IOPS 이다.
