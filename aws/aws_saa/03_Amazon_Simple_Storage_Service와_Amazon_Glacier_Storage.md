# 03. Amazon Simple Storage Service와 Amazon Glacier Storage
#TIL/aws/SAA

---

## Amazon S3

Amazon S3는 개인, 애플리케이션, 다수 AWS 서비스의 데이터를 보관하며, 다음과 같은 워크로드에 적합하다.  

- 백업 아카이브, 로그 파일, 재해 복구 이미지 유지 관리
- 분석을 위한 빅데이터 저장
- 정적 웹사이트 호스팅

운영 체제 볼륨은 블록 스토리지에 저장돼 EC2 인스턴스를 구동하는 반면 S3는 무제한 객체 스토리지 공간을 효과적으로 제공한다.  

- 블록 스토리지
	- 물리적 디스크를 개별 블록으로 나눠 데이터를 저장하고 파일 시스템으로 관리한다.
- 객체 스토리지
	- 구조화되지 않은 평면 저장소에 데이터를 저장한다.

S3에 파일을 쓸 때 최대 2KB 메타 데이터가 함께 저장된다.  
메타 데이터에는 데이터 사용 권한과 파일 시스템처럼 보여지는 중첩 버킷 내 위치 정보같은 시스템 세부 정보가 들어 있다.  


## S3 서비스 아키텍처

AWS 계정당 기본으로 만들 수 있는 버킷은 100개다.  

S3 버킷과 그 내용은 한 AWS 리전에만 존재하고, 버킷 주소는 전체 S3 글로벌 시스템 내에서 유일해야 한다.  
버킷 주소만으로 버킷에 액세스할 수 있도록 프로세스를 단순하게 하기 위함이다.  


### 접두사와 구분 기호

S3 버킷은 하위 폴더 구조가 없는 평면 구조지만, 접두사와 구분 기호를 사용해서 버킷을 좀 더 체계적으로 나타낼 수 있다.  
폴더 또는 디렉토리 구조로 객체를 업로드하면 S3는 이 구조를 실제 계층처럼 표현하고, 자동으로 구분 기호를 '/' 문자로 처리해서 변환한다.  


### 대용량 객체 작업

버킷에는 무한대 용량의 데이터를 저장할 수 있지만, 단일 객체 크기는 5TB를 넘을 수 없고, 한 번에는 5GB까지만 업로드할 수 있다.  

멀티 파트 업로드는 큰 객체를 여러 작은 부분으로 나눠서 S3 대상 위치로 하나씩 전송한다.  
AWS CLI나 상위 수준 API에서는 멀티 파트 업로드가 자동으로 실행되지만, 하위 수준 API에서는 객체를 수동으로 나눠야 한다.  


### 암호화

- 서버 측 암호화
	- 데이터 객체를 암호화해서 디스크에 저장하는 작업과 데이터를 가져올 때 적합한 인증으로 복호화하는 작업이 이루어진다.
	- 세 가지 종류의 서버 측 암호화가 있다.
		- Amazon S3가 관리하는 암호화 키(SSE-S3)를 사용하면 AWS가 자체 엔터프라이즈 표준 키를 사용해 암호화와 복호화 프로세스의 모든 단계를 관리한다.
		- AWS KMS-관리형 키를 사용하는 서버 측 암호화(SSE-KMS)를 사용하면 SSE-S3 기능에 더해 완벽한 키 사용 추적과 봉투 키를 사용할 수 있다.
		- 고객 제공 암호화 키에 의한 서버 측 암호화(SSE-C)는 고객이 S3에 제공한 자체 키로 객체를 암호화한다.
- 클라이언트 측 암호화
	- AWS KMS-관리형 고객 마스터 키를 사용하여 업로드 전에 고유 키로 객체를 암호화한다.
	- S3 암호화 클라이언트에서 제공된 클라이언트 측 마스터 키를 사용할 수도 있다.
	- 보통은 서버 측 암호화를 사용하지만, 회사 조직의 규정 상 암호화 키의 모든 권한을 가지고 있어야 하는 경우 클라이언트 암호화를 사용해야 한다.


### 로깅

S3 이벤트 추적을 로그 파일에 저장하는 기능은 처음엔 비활성화돼 있다.  
로깅을 활성화할 때는 원본 버킷과 대상 버킷을 지정해야 한다.  

S3 생성 로그는 구성하면 다음과 같은 작업 상세 항목이 나타난다.

- 요청자 계정과 IP 주소
- 원본 버킷 이름
- 요청 동작
- 요청 개시 시간
- 응답 상태

S3 버킷은 CloudWatch나 CloudTrail 같은 다른 AWS 서비스가 로그 또는 EBS 스냅샷 등의 다른 객체를 저장하는 데에도 사용된다.  


## S3 내구성과 가용성

- 내구성
	- 데이터가 손실되지 않을 확률
	- 대부분의 S3와 Amazon Glacier는 99.999999999% 내구성 보장
	- S3는 최소 3개 가용 영역에 데이터를 자동으로 복제하기 때문에 높은 내구성을 보장할 수 있다.
	- 복원력이 전혀 없는 두 가지 클래스도 있다.
		- Amazon S3 One Zone-IA(Infrequent Access)는 데이터를 단일 가용 영역에만 저장한다.
		- RRS(Reduced Redundancy Storage)는 다른 클래스보다 더 적은 영역에 복제하기 때문에 99.99% 내구성만 보장한다.
- 가용성
	- 객체가 사용 가능한 기간의 비율
	- 1년 동안 해당 객체를 요청했을 때 즉시 응답할 수 있는 기간
	- Amazon S3 Standard 클래스는 연간 99.99% 기간동안 데이터의 사용 가능 기간을 보장한다.
- 데이터의 최종 일관성
	- S3는 데이터를 여러 장소에 복제하므로, 기존 데이터가 업데이트되면 시스템에 전파하는 동안 약간의 지연이 발생할 수 있다.
	- 업데이트 후 여러 버전이 충돌하는 것을 피하기 위해 최종 일관성 표준에 따라 데이터 처리를 설계해야 하며, 보통 2초 이하의 지연 시간을 고려해야 한다.
	- 새로 객체를 생성할 때는 객체 버전이 충돌할 가능성이 없으므로 쓰기 후 읽기 일관성이 제공된다.


## S3 객체 수명 주기

S3의 워크로드는 보통 백업 아카이브와 관련이 있다.  
이전 아카이브의 유지 관리도 필요하지만, 오래된 버전을 정리하고 삭제해서 스토리지 비용을 절약하는 것도 중요하다.  
S3 버전 관리와 수명 주기 기능으로 이를 자동화할 수 있다.  

- 버전 관리
	- 같은 이름으로 객체를 저장하면 기존 객체를 덮어쓰는데, 이는 지난 버전을 관리할 수 없어 위험할 수도 있는 상황이 된다.
	- 버킷 수준에서 버전 관리를 활성화하면 덮어쓴 이전 객체를 보존할 수 있어서 기존 버전에 계속 액세스할 수 있다.
- 수명 주기 관리
	- 버킷에서 수명 주기 규칙을 설정하면 지정한 기간이 경과했을 때 자동으로 객체가 다른 스토리지 클래스로 옮겨진다.  
	- 예)
		- 첫 30일은 S3 Standard
		- 그 이후는 One Zone IA
		- 과거 버전을 유지해야 한다면 파일을 저렴한 장기 저장용 스토리지인 Glacier로 옮겨서 365일 간 보관하고 기간이 지나면 영구 삭제

## S3 Intelligent-Tiering

* S3 Standard와 동일한 짧은 지연 시간과 높은 처리량 성능
* 소액의 월별 모니터링 및 자동 계층화 수수료
* 액세스 패턴 변화를 기반으로 두 개의 액세스 계층 간에 객체를 자동으로 이동
* 여러 가용 영역에 걸쳐 99.999999999%의 객체 내구성을 제공하도록 설계
* 전체 가용 영역에 영향을 미치는 이벤트에 대한 복원력
* 연간 99.9%의 가용성을 제공하도록 설계
*  Amazon S3 서비스 수준 계약에 따라 가용성 보장
* 전송 데이터를 위한 SSL 및 저장 데이터의 암호화 지원
* 다른 S3 스토리지 클래스로 객체를 자동으로 마이그레이션하기 위한 S3 수명 주기 관리


## S3 객체 액세스

### 액세스 제어

액세스 제어 목록(ACL) 규칙, 세분화된 S3 버킷 정책, IAM 정책을 사용해 버킷이나 객체 수준에서 타 계정이나 외부 사용자에게 액세스를 허용할 수 있다.  
ACL은 IAM 서비스가 나오기 전에 사용하던 정책이기 때문에, 현재는 **ACL 대신 S3 버킷 정책이나 IAM 정책을 적용할 것을 권장**한다.  


### 미리 서명된 URL

미리 서명된 URL은 지정한 기간만 사용할 수 있으며 기간이 지나면 사용할 수 없고, 프로그래밍 방식으로 객체에 액세스할 수 있도록 미리 서명된 URL을 생성하는 명령을 코드에 포함해서 빌드할 수 있다.  
기본 만료 값은 3600초(1시간)이다.  


### 정적 웹사이트 호스팅

정적 웹사이트는 웹 페이지와 스크립트를 렌더링할 때 서버가 아닌 클라이언트 시스템 서비스를 사용한다.  
S3를 정적 호스팅으로 구성하면 버킷 URL 트래픽이 자동으로 지정된 루트 문서로 연결된다.  
오류 처리와 리다이렉션도 정적 웹사이트 호스팅 프로파일에 통합할 수 있다.  

DNS를 연결하려면 Amazon Route 53에서 버킷 엔드포인트를 연결하고, S3 버킷 이름을 도메인 이름과 똑같게 만들어야 제대로 작동한다.  
또한 무료 SSL/TLS 인증서를 ACM(Amazon Certificate Manager)에 요청해서 사이트를 암호화하고 S3 버킷을 원본으로 하는 CloudFront 배포판에 인증서를 가져올 수 있다.  


### S3 Select와 Glacier Select

AWS는 S3나 Glacier에 액세스할 수 있는 또 다른 방법을 제공하는데, 그것이 바로 Select이다.  
SQL과 유사한 쿼리로 저장된 객체에서 관련 데이터만 검색할 수 있으므로 훨씬 효율적이고 저렴하게 작업할 수 있다.  
전체 데이터를 내려받아서 발생하는 대역폭과 비용을 고려할 필요 없이 필요한 일부 데이터만 정확하게 가져올 수 있다.  

S3에 CSV를 올려 놓으면 데이터베이스처럼 SQL을 날려서 검색을 수행할 수 있다.  


## Amazon Glacier

Glacier는 S3 스토리지 클래스의 일부로 보여진다.  

- S3
	- 단일 객체 최대 크기는 5TB
	- 암호화가 선택 사항
	- 인간이 읽을 수 있는 이름으로 키 생성
	- 데이터에 거의 즉시 액세스 가능
- Glacier
	- 단일 객체 최대 크기는 40TB
	- 암호화가 기본 제공
	- 기계가 만든 ID
	- 데이터에 액세스하는 데에 몇 시간이 걸릴 수 있음

즉, 데이터의 필요성과 사용 빈도가 낮은 환경에서 장기적으로 데이터를 보관할 수 있는 저렴한 스토리지로 사용할 수 있다는 것이다.  


## 기타 스토리지 관련 서비스

### Amazon Elastic File System(EFS)

EFS는 자동 확장 가능한 공유 파일 스토리지이다.  
VPC 내에서 Network File System(NFS)으로 여러 EC2 인스턴스에 장착하거나 AWS Direct Connect 연결로 온프레미스 서버에서 액세스할 수 있도록 설계됐다.  

여러 인스턴스가 짧은 지연 시간으로 안전하고 내구성 있게 파일을 공유하는 데 사용할 수 있다.  

> 온프레미스란 원격 환경이 아닌 자체적으로 보유한 전산실 서버에 직접 설치해 운영하는 방식을 말한다.


### AWS Storage Gateway

Storage Gateway는 아카이브를 AWS 클라우드로 백업하는 것을 단순화하도록 설계됐다.  


### AWS Snowball

테라바이트 또는 페타바이트 크기 데이터를 백업 또는 실제 사용을 위해 AWS로 이동할 때, 사용할 수 있는 장치이다.  

































